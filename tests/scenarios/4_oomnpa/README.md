## 💾 시나리오 5: OOM 중 CSV 파일 저장 실패 – atomicwriter 미사용 vs 사용 비교

### 🎯 목적

대용량 CSV 파일 저장 중 **OOM(Out of Memory)** 발생 시, 일반적인 저장 방식과 `atomicwriter` 사용 방식의 **신뢰성 차이**를 확인한다.

---

### 🔍 문제 설명

- 대용량 데이터를 저장할 때, 메모리 부족으로 인해 `MemoryError`가 발생할 수 있음.
- 일반 파일 저장 방식(`open`, `write`)은 중간에 오류가 나면 **깨진 파일**이 그대로 남아 향후 사용 시 예측 불가한 문제가 발생함.
- 반면 `atomicwriter`는 **작업이 성공한 경우에만 최종 파일을 덮어쓰므로**, 실패 시 파일이 깨지지 않음.

---

### ⚠️ `before.py` - 일반 방식

- `open()`으로 파일 연 뒤, CSV 데이터를 반복 저장
- 중간에 `MemoryError`가 발생하면 **빈 파일 또는 손상된 파일이 생성됨**
- 후속 작업에서 이 파일을 사용할 경우 문제 발생 가능

---

### ✅ `after.py` - `atomicwriter` 사용

- `atomicwriter.write()` 컨텍스트 내에서 CSV 저장
- 중간에 `MemoryError`가 발생해도 **최종 파일은 생성되지 않거나 이전 상태 유지**
- 결과적으로 파일 무결성이 보장됨

---

### 🧪 테스트 방법

1. `before.py` 실행
   - `data/oom_csv_output.csv` 생성됨
   - 중간 실패로 파일이 **깨졌는지 확인** (파일이 비정상적으로 작거나 내용 없음)

2. `after.py` 실행
   - 동일한 OOM 유도
   - 파일이 아예 없거나, 기존 정상 파일로 유지됨 → ✅ 안전성 확인
