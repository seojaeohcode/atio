## 📂 시나리오 3: CI/CD 실패 – 자동화 배치 도중 오류 발생 → 후속 작업 오류

### 🔍 문제 설명

CI/CD 파이프라인에서는 여러 단계를 거쳐 빌드 아티팩트를 생성하고 배포합니다.  
이 과정에서 중간 파일을 저장하는 도중 에러가 발생하면, 손상된 파일이 후속 단계로 전달되어 전체 배포가 실패하거나 디버깅이 어려워질 수 있습니다.

**예시 상황:**

- `ci_artifact.txt`를 생성한 직후, 설정 오류나 외부 종속성 문제로 파이프라인이 중단됨
- 손상되었거나 미완성된 파일이 존재하게 됨
- 후속 작업에서 이 파일을 참조해 전체 파이프라인이 실패하거나 예측 불가한 동작 발생

---

### ⚠️ `before.py`

- 일반적인 방식으로 `open()`과 `write()` 사용
- 중간에 예외(Exception)가 발생하면 파일은 이미 존재한 상태
- 이 파일은 후속 작업에서 오류를 유발할 수 있음

---

### ✅ `after.py`

- `atomicwriter.write()`를 사용해 임시 경로에 먼저 파일을 생성
- 모든 작업이 성공한 후에만 대상 위치(`ci_artifact.txt`)로 이동됨
- 도중에 실패하면 대상 파일은 아예 생성되지 않거나 이전 버전 그대로 유지
- 결과적으로 배포 파이프라인이 안정적이고 복구 가능한 상태 유지

---

### 🧪 테스트 방법

1. `before.py`를 실행
   - 실행 중간에 오류가 발생하도록 구성됨
   - `ci_artifact.txt`가 남아 있는지 확인 → 손상된 상태일 가능성 높음

2. `after.py`를 실행
   - 동일한 오류가 발생하지만 `ci_artifact.txt`는 안전하게 보호됨
   - 파이프라인 후속 작업에도 영향 없음
